RocksDB

基于 LevelDB 开发的一款提供键值存储与读写功能的 LSM-tree 架构引擎
- 功能：键值数据库，单机存储
- 特点：高性能、可拓展、可靠、稳定性高。
- 与leveldb区别：
    - 支持一次获取多个K-V
    - 提供了一个Merge操作，对多个Put操作进行合并
    - 支持多线程合并，而LevelDB是单线程合并

技术基础：
1.LSM树：
背景：追加写增加了空间浪费，原地写增加额外查找代价。
简介：LSM将数据分为多个层，每一层都是一个有序的键值存储文件，其中较旧的数据位于较低的层，较新的数据位于较高的层。当数据被写入时，它首先被写入到一个内存中的结构，称为内存表（MemTable），然后在后台异步地将内存表与磁盘上的某个层合并，最终生成新的文件。
总结：以空间换时间，通过追加写提高写性能，分层+排序提高查找效率，整体上看是牺牲了读性能，适合写多读少场景。
![](/笔记/rocksdb/image/lsm.png) 

2.压缩（Compact）
背景：LSM tree本身的存储结构牺牲了读性能，需要通过compact来降低读对系统的影响。
思路：写流程中先写入Memtable，写满后，Memtable会被后台线程Flush到磁盘文件即Level-0。当Level-0文件的数量达到了限定的数量，Compact线程会将Level-0的文件Compact到Level-1。

3.事务
Rocksdb 的事务实现 主要是通过TransactionDB 默认是(Pessimistic) 和 OptimisticTransactionDB 来提供事务操作。两种事务加锁方式不同，悲观的加锁，乐观的版本控制（MVCC）。

4.WAL
背景：内存中的Memtable在节点异常时会丢失，所以需要日志重放memtable中未commited的数据。
思路：双写（单线程写WAL+多线程写库），WAL的写入需要优先于memtable，且每一次写入都需要flush。

[待补充]